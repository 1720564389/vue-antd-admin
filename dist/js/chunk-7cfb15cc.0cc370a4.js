(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7cfb15cc"],{a15b:function(e,t,a){"use strict";var n=a("23e7"),r=a("44ad"),o=a("fc6a"),l=a("a640"),i=[].join,s=r!=Object,c=l("join",",");n({target:"Array",proto:!0,forced:s||!c},{join:function(e){return i.call(o(this),void 0===e?",":e)}})},a3cc:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-tree",{attrs:{checkable:"","tree-data":e.treeData,checkedKeys:e.checkKeyList},on:{check:e.handleSelect}})},r=[],o=(a("99af"),a("4de4"),a("4160"),a("159b"),a("5530")),l=a("2f62"),i=a("a18c"),s=(a("d3b7"),a("31c2"));function c(e){return new Promise((function(t,a){var n=[];n="admin"==e?i["a"]:"text"==e||"editor"==e?Object(s["filterAsyncRoute"])(i["a"],e):[],t({data:n,code:200,message:"路由获取成功!"})}))}var u={name:"standardTree",props:{role:String},data:function(){return{treeData:[],checkKeyList:[]}},computed:Object(o["a"])(Object(o["a"])({},Object(l["b"])(["baseRoute"])),{},{asyncRoutes:function(){return i["a"]}}),created:function(){var e=this.filtrRoute(this.asyncRoutes);this.treeData=this.generateRoutes(e),this.gerRoleRoute()},methods:{gerRoleRoute:function(){var e=this;c(this.role).then((function(t){var a=t.data||[],n=e.filtrRoute(a);e.checkKeyList=e.getSelectRoute(n)}))},filtrRoute:function(e){return 0==e.length?[]:e.filter((function(e){return e.children}))[0].children},generateRoutes:function(e){var t=this,a=[];return e.forEach((function(e){var n={key:e.path,title:e.meta.title};e.children&&(n.children=t.generateRoutes(e.children)),a.push(n)})),a},getSelectRoute:function(e){var t=this,a=[];return e.forEach((function(e){e.children?a=a.concat(t.getSelectRoute(e.children)):a.push(e.path)})),a},handleSelect:function(e){this.checkKeyList=e}},watch:{role:function(e,t){this.gerRoleRoute()}}},d=u,h=a("2877"),m=Object(h["a"])(d,n,r,!1,null,"edb849e6",null);t["a"]=m.exports},a567:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tableCommon-wrapper"},[a("a-table",{attrs:{columns:e.tableHead,dataSource:e.tableData,loading:e.loading,pagination:e.pagination,"row-selection":e.rowSelection},scopedSlots:e._u([e._l(Object.keys(e.$scopedSlots).filter((function(e){return"expandedRowRender"!==e})),(function(t){return{key:t,fn:function(a,n,r){return[e._t(t,null,null,{text:a,record:n,index:r})]}}}))],null,!0)})],1)},r=[],o={name:"standardTable",props:{tableHead:{type:Array,required:!0},tableData:{type:Array,required:!0},loading:{type:Boolean,default:!1},pagination:{type:Boolean,default:!0},rowSelection:{type:Object}},data:function(){return{}}},l=o,i=a("2877"),s=Object(i["a"])(l,n,r,!1,null,"37900d19",null);t["a"]=s.exports},b71b:function(e,t,a){"use strict";var n=a("dfbf"),r=a.n(n);r.a},c999:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"userManage-wrapper"},[a("a-card",{attrs:{hoverable:!0,bordered:!1}},[a("div",{staticClass:"flex flex-wrap",attrs:{slot:"title"},slot:"title"},[a("a-button",{staticClass:"select-bottom",attrs:{type:"primary",icon:"plus"},on:{click:e.handleAdd}},[e._v(" 新增用户 ")]),a("a-button",{staticStyle:{margin:"0 16px 10px"},attrs:{type:"danger",icon:"delete",loading:e.deleteLoading},on:{click:e.handleBatchDelete}},[e._v(" 批量删除 ")]),a("a-select",{staticClass:"select-width",attrs:{placeholder:"用户权限",allowClear:""},on:{change:e.changeRole}},e._l(e.roleOption,(function(t){return a("a-select-option",{key:t.key,attrs:{value:t.key}},[e._v(" "+e._s(t.label)+" ")])})),1),a("a-input",{staticClass:"select-width",attrs:{placeholder:"用户名",allowClear:""},on:{pressEnter:e.handleSearch},model:{value:e.tableQuery.username,callback:function(t){e.$set(e.tableQuery,"username",t)},expression:"tableQuery.username"}}),a("a-range-picker",{staticClass:"select-width",staticStyle:{width:"210px"},attrs:{placeholder:["开始日期","结束日期"],allowClear:""},on:{change:e.changeTime}}),a("a-button",{staticClass:"select-bottom",staticStyle:{"margin-right":"16px"},attrs:{type:"primary",icon:"search"},on:{click:e.handleSearch}},[e._v(" 查询 ")]),a("a-button",{staticClass:"select-bottom",attrs:{type:"primary",icon:"export",loading:e.exportLoading},on:{click:e.handleExport}},[e._v(" 导出 ")])],1),a("standard-table",{attrs:{tableData:e.tableData,tableHead:e.tableHead,loading:e.loading,pagination:!1,rowSelection:{selectedRowKeys:e.selectedRowKeys,onChange:e.handleSelect,getCheckboxProps:e.getCheckboxProps}},scopedSlots:e._u([{key:"index",fn:function(t){var n=t.index;return a("div",{},[e._v(" "+e._s(n+1)+" ")])}},{key:"role",fn:function(t){var n=t.text;return a("div",{},[a("a-tag",{attrs:{color:e._f("statusFilter")(n)}},[e._v(" "+e._s(n)+" ")])],1)}},{key:"action",fn:function(t){var n=t.text;return a("div",{},[a("a-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.handleEdit(n)}}},[e._v(" 编辑 ")]),a("a-popconfirm",{attrs:{title:"你确定要删除当前列吗?","ok-text":"是","cancel-text":"否",disabled:n.role&&"admin"==n.role},on:{confirm:function(t){return e.handleDelete(n)}}},[a("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"danger",size:"small",disabled:n.role&&"admin"==n.role}},[e._v(" 删除 ")])],1)],1)}}])})],1),e.dialogVisible?a("user-model",{attrs:{roleOption:e.roleOption,currentRow:e.currentRow,dialogVisible:e.dialogVisible},on:{cancel:function(t){e.dialogVisible=!1},ok:e.handleOk}}):e._e()],1)},r=[],o=(a("4160"),a("a15b"),a("d81d"),a("b0c0"),a("d3b7"),a("25f0"),a("159b"),a("5530")),l=a("b775");function i(e){return l["a"].post("/userManage/userTable",e)}function s(e){return l["a"].post("/userManage/deleteTable",e)}function c(e){return l["a"].post("/userManage/batchDeleteTable",e)}function u(e){return l["a"].post("/userManage/editTable",e)}function d(e){return l["a"].post("/userManage/addTable",e)}var h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:e.currentRow?"编辑":"新增",visible:e.dialogVisible,okText:"确认",cancelText:"取消",width:620,confirmLoading:e.loading},on:{ok:e.handleSure,cancel:function(){e.$emit("cancel")}}},[a("a-form-model",{ref:"userFrom",attrs:{model:e.userFrom,rules:e.userRule,"label-col":{span:4},"wrapper-col":{span:16},hideRequiredMark:""}},[a("a-form-model-item",{directives:[{name:"show",rawName:"v-show",value:e.currentRow,expression:"currentRow"}],attrs:{prop:"id",label:"id"}},[a("a-input",{attrs:{disabled:""},model:{value:e.userFrom.id,callback:function(t){e.$set(e.userFrom,"id",t)},expression:"userFrom.id"}})],1),a("a-form-model-item",{attrs:{prop:"username",label:"用户名",hasFeedback:""}},[a("a-input",{model:{value:e.userFrom.username,callback:function(t){e.$set(e.userFrom,"username",t)},expression:"userFrom.username"}})],1),a("a-form-model-item",{attrs:{prop:"password",label:"密码",hasFeedback:""}},[a("a-input",{model:{value:e.userFrom.password,callback:function(t){e.$set(e.userFrom,"password",t)},expression:"userFrom.password"}})],1),a("a-form-model-item",{attrs:{prop:"role",label:"权限"}},[a("a-radio-group",{model:{value:e.userFrom.role,callback:function(t){e.$set(e.userFrom,"role",t)},expression:"userFrom.role"}},e._l(e.roleOption,(function(t){return a("a-radio",{key:t.key,attrs:{value:t.key}},[e._v(" "+e._s(t.label)+" ")])})),1)],1),a("a-form-model-item",{attrs:{prop:"text",label:"描述"}},[a("a-textarea",{attrs:{placeholder:"描述...",autoSize:{minRows:3,maxRows:5}},model:{value:e.userFrom.text,callback:function(t){e.$set(e.userFrom,"text",t)},expression:"userFrom.text"}})],1),a("a-form-model-item",{attrs:{prop:"menu",label:"菜单"}},[a("standard-tree",{attrs:{role:e.userFrom.role}})],1)],1)],1)},m=[],f=a("a3cc"),p={name:"userModel",props:{currentRow:[Object,null],dialogVisible:Boolean,roleOption:Array},components:{standardTree:f["a"]},data:function(){return{userRule:{username:[{required:!0,trigger:"blur",message:"用户名不能为空！"}],password:[{required:!0,trigger:"blur",min:6,message:"密码不能少于6位！"}],role:[{required:!0,trigger:"blur",message:"请选择用户权限！"}],text:[{required:!0,trigger:"blur",min:5,message:"请至少输入五个字符描述！"}]},userFrom:{role:""},loading:!1}},mounted:function(){this.userFrom=Object(o["a"])({},this.currentRow)||{role:""}},methods:{handleSure:function(){var e=this;this.$refs.userFrom.validate((function(t){e.loading=!0,t?e.currentRow?u(e.userFrom).then((function(){e.$message.success("修改成功!"),e.loading=!1,e.$emit("ok")})):d(e.userFrom).then((function(){e.$message.success("添加成功!"),e.loading=!1,e.$emit("ok")})):e.loading=!1}))}}},b=p,g=a("2877"),v=Object(g["a"])(b,h,m,!1,null,null,null),x=v.exports,y=a("a567"),k=a("c1df"),w=a.n(k);a("5c3a");w.a.locale("zh-cn");var R=[{title:"序号",dataIndex:"index",scopedSlots:{customRender:"index"},width:60},{title:"id",dataIndex:"id",ellipsis:!0},{title:"用户名",dataIndex:"username"},{title:"密码",dataIndex:"password"},{title:"权限",dataIndex:"role",scopedSlots:{customRender:"role"}},{title:"创建日期",dataIndex:"date",defaultSortOrder:"ascend",sorter:function(e,t){return e.date>t.date},ellipsis:!0},{title:"描述",dataIndex:"text",ellipsis:!0},{title:"操作",scopedSlots:{customRender:"action"},width:140}],_={name:"userManage",components:{standardTable:y["a"],userModel:x},filters:{statusFilter:function(e){var t={admin:"#f50",test:"#2db7f5",editor:"#87d068",custom:""};return t[e]}},data:function(){return{roleOption:[{key:"admin",label:"超级管理员"},{key:"test",label:"普通用户"},{key:"editor",label:"作家"},{key:"custom",label:"自定义"}],tableQuery:{role:null,username:"",startTime:"",endTime:"",page:1,size:10},loading:!1,deleteLoading:!1,exportLoading:!1,tableData:[],selectedRowKeys:[],selectValue:[],dialogVisible:!1,currentRow:null,tableHead:R}},mounted:function(){this.getTableList()},methods:{changeRole:function(e){this.tableQuery.role=e},changeTime:function(e,t){Object.assign(this.tableQuery,{startTime:t[0],endTime:t[1]})},getCheckboxProps:function(e){return{props:{disabled:"admin"===e.role,name:e.name}}},handleSelect:function(e,t){this.selectedRowKeys=e,this.selectValue=t},handleSearch:function(){this.getTableList()},handleDelete:function(e){var t=this;s({id:e.id}).then((function(){t.$message.success("删除成功!"),t.getTableList()}))},handleBatchDelete:function(){var e=this;if(0!=this.selectValue.length){this.deleteLoading=!0;var t=this.selectValue.map((function(e){return e.id})).join(",");c({batchId:t}).then((function(){e.$message.success("删除成功!"),e.getTableList(),e.deleteLoading=!1}))}else this.$message.error("请至少勾选一项")},handleEdit:function(e){this.currentRow=Object(o["a"])({},e),this.dialogVisible=!0},handleAdd:function(){this.currentRow=null,this.dialogVisible=!0},handleOk:function(){this.dialogVisible=!1,this.currentRow=null,this.getTableList()},handleExport:function(){var e=this;this.exportLoading=!0,Promise.all([a.e("chunk-0d9d4976"),a.e("chunk-2133cd4f")]).then(a.bind(null,"4bf8")).then((function(t){var a=[],n=[];e.tableHead.forEach((function(e){"操作"!=e.title&&"序号"!=e.title&&(a.push(e.title),n.push(e.dataIndex))}));var r=e.formatJson(n);t.export_json_to_excel({header:a,data:r,filename:"用户列表"}),e.exportLoading=!1}))},formatJson:function(e){return this.tableData.map((function(t){return e.map((function(e){return t[e].toString()}))}))},getTableList:function(){var e=this;this.loading=!0,i(this.tableQuery).then((function(t){var a=t.data||[];Object.assign(e,{tableData:a,loading:!1})}))}}},S=_,F=(a("b71b"),Object(g["a"])(S,n,r,!1,null,"6ae8a749",null));t["default"]=F.exports},dfbf:function(e,t,a){}}]);